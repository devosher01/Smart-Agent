@if (!user || (!user.id && !user._id)) {
  <button
    mat-stroked-button
    (click)="openAuthModal()"
    class="rounded-full border-slate-300 dark:border-slate-700"
  >
    Log in
  </button>
} @else {
  <!-- Agent Wallet Card -->
  <button
    class="flex items-center gap-3 px-3 py-1.5 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm cursor-pointer hover:shadow-md transition-all group"
    [matMenuTriggerFor]="userActions"
  >
    <!-- Wallet/User Icon -->
    <div
      class="w-8 h-8 rounded-lg bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center group-hover:bg-indigo-100 dark:group-hover:bg-indigo-900/50 transition-colors"
    >
      <mat-icon
        class="text-indigo-600 dark:text-indigo-400 !w-5 !h-5 !text-[20px]"
        svgIcon="heroicons_outline:user-circle"
      ></mat-icon>
    </div>

    <!-- Text Info -->
    <div class="flex flex-col items-start min-w-[100px]">
      <span class="text-xs font-bold text-slate-800 dark:text-slate-200 leading-tight">
        {{ user.name || 'User' }}
      </span>
      <div class="flex items-center gap-1.5 leading-none mt-0.5">
        <span class="text-[10px] font-bold text-indigo-600 dark:text-indigo-400">{{
          user.credits || '0.00' | number: '1.2-4'
        }}</span>
        <span class="text-[9px] font-bold text-slate-400 mt-[1px]">CREDITS</span>
      </div>
    </div>
  </button>
}

<mat-menu [xPosition]="'before'" #userActions="matMenu">
  <button mat-menu-item disabled class="cursor-default opacity-100">
    <span class="flex flex-col leading-tight">
      <span class="text-xs font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400">
        {{ 'userMenu.welcome' | transloco }}
      </span>
      <span class="mt-2 text-sm font-semibold text-gray-900 dark:text-gray-100">
        {{ user?.name || '—' }}
      </span>
      <span class="text-sm text-gray-600 dark:text-gray-300">
        {{ user?.email || '—' }}
      </span>
      <span class="text-sm text-gray-600 dark:text-gray-300">
        <span class="font-medium text-gray-500 dark:text-gray-400">
          {{ 'userMenu.role' | transloco }}
        </span>
        {{ user?.role || '—' }}
      </span>
    </span>
  </button>
  <mat-divider class="my-2"></mat-divider>
  <button mat-menu-item (click)="signOut()">
    <mat-icon [svgIcon]="'heroicons_outline:arrow-right-on-rectangle'"></mat-icon>
    <span>{{ 'userMenu.signOut' | transloco }}</span>
  </button>
</mat-menu>
